<div class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-8">
  <%= form_with model: @book, local: true, class: "space-y-6" do |form| %>
    
    <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º -->
    <% if @book.errors.any? %>
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        <h4 class="font-bold">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š</h4>
        <ul class="list-disc list-inside">
          <% @book.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ› -->
    <div class="space-y-2">
      <%= form.label :title, "æ›¸ç±ã‚¿ã‚¤ãƒˆãƒ«", class: "block text-sm font-medium text-gray-700" %>
      <%= form.text_field :title, 
          class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors",
          placeholder: "èª­ã‚“ã æœ¬ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" %>
    </div>

    <!-- ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="space-y-4 p-6 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl border border-amber-200">
      <h3 class="text-lg font-semibold text-amber-800 flex items-center gap-2">
        ğŸ¨ ã“ã®æœ¬ã‹ã‚‰æ„Ÿã˜ãŸè‰²
      </h3>
      
      <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆè‰²ãƒ‘ãƒ¬ãƒƒãƒˆ -->
      <div class="space-y-3">
        <p class="text-sm text-gray-600">ã‚ˆãä½¿ã‚ã‚Œã‚‹èª­æ›¸ã®è‰²ã‹ã‚‰é¸ã¶</p>
        <div class="grid grid-cols-4 sm:grid-cols-8 gap-3">
          <% preset_colors = [
            { code: '#ff6b6b', name: 'æƒ…ç†±ã®èµ¤' },
            { code: '#ff8e53', name: 'æ¸©ã‹ã„ã‚ªãƒ¬ãƒ³ã‚¸' },
            { code: '#fdcb6e', name: 'æ¥½ã—ã„é»„è‰²' },
            { code: '#4ecdc4', name: 'ç™’ã—ã®æ°´è‰²' },
            { code: '#95e1d3', name: 'å®‰ã‚‰ãã®ç·‘' },
            { code: '#74b9ff', name: 'çŸ¥æ€§ã®é’' },
            { code: '#a29bfe', name: 'æ€ç´¢ã®ç´«' },
            { code: '#fd79a8', name: 'ãƒ­ãƒãƒ³ãƒãƒƒã‚¯ãƒ”ãƒ³ã‚¯' }
          ] %>
          <% preset_colors.each do |color| %>
            <button type="button" 
                    onclick="selectColor('<%= color[:code] %>')"
                    class="w-12 h-12 rounded-lg border-2 border-gray-300 hover:border-amber-400 transition-all duration-200 hover:scale-110 shadow-sm"
                    style="background-color: <%= color[:code] %>"
                    title="<%= color[:name] %>">
            </button>
          <% end %>
        </div>
      </div>

      <!-- ã‚«ã‚¹ã‚¿ãƒ è‰²é¸æŠ -->
      <div class="space-y-3">
        <p class="text-sm text-gray-600">ã¾ãŸã¯è‡ªç”±ã«è‰²ã‚’é¸ã¶</p>
        <div class="flex items-center gap-4">
          <%= form.color_field :color_code, 
              id: "color_picker",
              class: "w-16 h-16 rounded-lg border-2 border-gray-300 cursor-pointer",
              onchange: "updateColorPreview(this.value)",
              value: (@book.color_code.present? ? @book.color_code : '#ffffff') %>
          
          <div class="flex-1">
            <%= form.text_field :color_code, 
                id: "color_code_input",
                class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors font-mono",
                placeholder: "#ff6b6b",
                pattern: "^#[0-9A-Fa-f]{6}$",
                oninput: "updateColorPicker(this.value)",
                value: (@book.color_code.present? ? @book.color_code : '#ffffff') %>
          </div>
          
          <!-- è‰²ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
          <div id="color_preview" 
               class="w-16 h-16 rounded-lg border-2 border-gray-300 shadow-inner"
               style="background-color: <%= @book.color_code.present? ? @book.color_code : '#ffffff' %>">
          </div>
        </div>
      </div>
    </div>

    <!-- æ„Ÿæƒ³ãƒ»ãƒ¡ãƒ¢ï¼ˆcommentã«ä¿®æ­£ï¼‰ -->
    <div class="space-y-2">
      <%= form.label :comment, "èª­æ›¸ãƒ¡ãƒ¢", class: "block text-sm font-medium text-gray-700" %>
      <%= form.text_area :comment, 
          class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors resize-none",
          rows: 4,
          placeholder: "ã“ã®æœ¬ã®æ„Ÿæƒ³ã‚’ï¼‘è¡Œç¨‹åº¦ã§å…¥åŠ›ã—ã¦ä¸‹ã•ã„" %>
    </div>

    <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
    <div class="flex gap-4 pt-4">
      <%= form.submit (@book.new_record? ? "æœ¬ã‚’ç™»éŒ²ã™ã‚‹" : "æ›´æ–°ã™ã‚‹"), 
          class: "flex-1 bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg" %>
      
      <%= link_to "ã‚­ãƒ£ãƒ³ã‚»ãƒ«", root_path, 
          class: "flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-3 px-6 rounded-lg transition-colors duration-200 text-center" %>
    </div>
  <% end %>
</div>

<script>
  // ãƒ—ãƒªã‚»ãƒƒãƒˆè‰²ã‚’é¸æŠã™ã‚‹é–¢æ•°
  function selectColor(colorCode) {
    document.getElementById('color_picker').value = colorCode;
    document.getElementById('color_code_input').value = colorCode;
    document.getElementById('color_preview').style.backgroundColor = colorCode;
  }

  // ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã‹ã‚‰è‰²ãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚
  function updateColorPreview(colorCode) {
    document.getElementById('color_code_input').value = colorCode;
    document.getElementById('color_preview').style.backgroundColor = colorCode;
  }

  // ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã‹ã‚‰è‰²ãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚
  function updateColorPicker(colorCode) {
    // æœ‰åŠ¹ãªè‰²ã‚³ãƒ¼ãƒ‰ã‹ãƒã‚§ãƒƒã‚¯
    if (/^#[0-9A-Fa-f]{6}$/.test(colorCode)) {
      document.getElementById('color_picker').value = colorCode;
      document.getElementById('color_preview').style.backgroundColor = colorCode;
    }
  }

  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè‰²ã‚’è¨­å®š
  document.addEventListener('DOMContentLoaded', function() {
    const colorInput = document.getElementById('color_code_input');
    const colorPicker = document.getElementById('color_picker');
    const colorPreview = document.getElementById('color_preview');
    
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè‰²ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆ
    if (!colorInput.value || colorInput.value === '') {
      const defaultColor = '#ffffff';
      colorInput.value = defaultColor;
      colorPicker.value = defaultColor;
      colorPreview.style.backgroundColor = defaultColor;
    }
  });
</script>